<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ScanResult.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ApiPosture Core</a> &gt; <a href="index.source.html" class="el_package">com.apiposture.core.models</a> &gt; <span class="el_source">ScanResult.java</span></div><h1>ScanResult.java</h1><pre class="source lang-java linenums">package com.apiposture.core.models;

import com.fasterxml.jackson.annotation.JsonProperty;

import java.time.Duration;
import java.time.Instant;
import java.util.*;

/**
 * Result of a security scan containing endpoints, findings, and metadata.
 */
<span class="nc" id="L12">public record ScanResult(</span>
        @JsonProperty(&quot;projectPath&quot;) String projectPath,
        @JsonProperty(&quot;endpoints&quot;) List&lt;Endpoint&gt; endpoints,
        @JsonProperty(&quot;findings&quot;) List&lt;Finding&gt; findings,
        @JsonProperty(&quot;scannedFiles&quot;) int scannedFiles,
        @JsonProperty(&quot;scanDuration&quot;) Duration scanDuration,
        @JsonProperty(&quot;timestamp&quot;) Instant timestamp
) {
    /**
     * Create scan result with current timestamp.
     */
    public ScanResult(String projectPath, List&lt;Endpoint&gt; endpoints, List&lt;Finding&gt; findings,
                      int scannedFiles, Duration scanDuration) {
<span class="nc" id="L25">        this(projectPath, endpoints, findings, scannedFiles, scanDuration, Instant.now());</span>
<span class="nc" id="L26">    }</span>

    /**
     * Get findings grouped by severity.
     */
    public Map&lt;Severity, List&lt;Finding&gt;&gt; getFindingsBySeverity() {
<span class="nc" id="L32">        Map&lt;Severity, List&lt;Finding&gt;&gt; result = new EnumMap&lt;&gt;(Severity.class);</span>
<span class="nc bnc" id="L33" title="All 2 branches missed.">        for (Severity severity : Severity.values()) {</span>
<span class="nc" id="L34">            result.put(severity, new ArrayList&lt;&gt;());</span>
        }
<span class="nc bnc" id="L36" title="All 2 branches missed.">        for (Finding finding : findings) {</span>
<span class="nc" id="L37">            result.get(finding.severity()).add(finding);</span>
<span class="nc" id="L38">        }</span>
<span class="nc" id="L39">        return result;</span>
    }

    /**
     * Get count of findings for each severity.
     */
    public Map&lt;Severity, Integer&gt; getSeverityCounts() {
<span class="nc" id="L46">        Map&lt;Severity, Integer&gt; counts = new EnumMap&lt;&gt;(Severity.class);</span>
<span class="nc bnc" id="L47" title="All 2 branches missed.">        for (Severity severity : Severity.values()) {</span>
<span class="nc" id="L48">            counts.put(severity, 0);</span>
        }
<span class="nc bnc" id="L50" title="All 2 branches missed.">        for (Finding finding : findings) {</span>
<span class="nc" id="L51">            counts.merge(finding.severity(), 1, Integer::sum);</span>
<span class="nc" id="L52">        }</span>
<span class="nc" id="L53">        return counts;</span>
    }

    /**
     * Get endpoints grouped by classification.
     */
    public Map&lt;SecurityClassification, List&lt;Endpoint&gt;&gt; getEndpointsByClassification() {
<span class="nc" id="L60">        Map&lt;SecurityClassification, List&lt;Endpoint&gt;&gt; result = new EnumMap&lt;&gt;(SecurityClassification.class);</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">        for (SecurityClassification classification : SecurityClassification.values()) {</span>
<span class="nc" id="L62">            result.put(classification, new ArrayList&lt;&gt;());</span>
        }
<span class="nc bnc" id="L64" title="All 2 branches missed.">        for (Endpoint endpoint : endpoints) {</span>
<span class="nc bnc" id="L65" title="All 2 branches missed.">            if (endpoint.classification() != null) {</span>
<span class="nc" id="L66">                result.get(endpoint.classification()).add(endpoint);</span>
            }
<span class="nc" id="L68">        }</span>
<span class="nc" id="L69">        return result;</span>
    }

    /**
     * Check if there are any findings at or above the given severity.
     */
    public boolean hasFindings(Severity minSeverity) {
<span class="nc" id="L76">        return findings.stream()</span>
<span class="nc" id="L77">                .anyMatch(f -&gt; f.severity().isAtLeast(minSeverity));</span>
    }

    /**
     * Get the highest severity among all findings.
     */
    public Optional&lt;Severity&gt; getHighestSeverity() {
<span class="nc" id="L84">        return findings.stream()</span>
<span class="nc" id="L85">                .map(Finding::severity)</span>
<span class="nc" id="L86">                .max(Comparator.comparingInt(Severity::getLevel));</span>
    }

    /**
     * Get total number of findings.
     */
    public int getTotalFindings() {
<span class="nc" id="L93">        return findings.size();</span>
    }

    /**
     * Get total number of endpoints.
     */
    public int getTotalEndpoints() {
<span class="nc" id="L100">        return endpoints.size();</span>
    }

    /**
     * Builder for ScanResult.
     */
    public static Builder builder() {
<span class="nc" id="L107">        return new Builder();</span>
    }

<span class="nc" id="L110">    public static class Builder {</span>
        private String projectPath;
<span class="nc" id="L112">        private List&lt;Endpoint&gt; endpoints = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L113">        private List&lt;Finding&gt; findings = new ArrayList&lt;&gt;();</span>
        private int scannedFiles;
        private Duration scanDuration;
<span class="nc" id="L116">        private Instant timestamp = Instant.now();</span>

        public Builder projectPath(String projectPath) {
<span class="nc" id="L119">            this.projectPath = projectPath;</span>
<span class="nc" id="L120">            return this;</span>
        }

        public Builder endpoints(List&lt;Endpoint&gt; endpoints) {
<span class="nc" id="L124">            this.endpoints = new ArrayList&lt;&gt;(endpoints);</span>
<span class="nc" id="L125">            return this;</span>
        }

        public Builder addEndpoint(Endpoint endpoint) {
<span class="nc" id="L129">            this.endpoints.add(endpoint);</span>
<span class="nc" id="L130">            return this;</span>
        }

        public Builder findings(List&lt;Finding&gt; findings) {
<span class="nc" id="L134">            this.findings = new ArrayList&lt;&gt;(findings);</span>
<span class="nc" id="L135">            return this;</span>
        }

        public Builder addFinding(Finding finding) {
<span class="nc" id="L139">            this.findings.add(finding);</span>
<span class="nc" id="L140">            return this;</span>
        }

        public Builder scannedFiles(int scannedFiles) {
<span class="nc" id="L144">            this.scannedFiles = scannedFiles;</span>
<span class="nc" id="L145">            return this;</span>
        }

        public Builder scanDuration(Duration scanDuration) {
<span class="nc" id="L149">            this.scanDuration = scanDuration;</span>
<span class="nc" id="L150">            return this;</span>
        }

        public Builder timestamp(Instant timestamp) {
<span class="nc" id="L154">            this.timestamp = timestamp;</span>
<span class="nc" id="L155">            return this;</span>
        }

        public ScanResult build() {
<span class="nc" id="L159">            return new ScanResult(projectPath, endpoints, findings, scannedFiles, scanDuration, timestamp);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>